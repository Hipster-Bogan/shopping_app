{% extends "base.html" %}
{% block title %}{{ shopping_list.name }}{% endblock %}

{% block head %}
<style>
  .list-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px;
    background: white;
    border-radius: 10px;
    box-shadow: 0 1px 2px rgba(0,0,0,0.1);
    margin-bottom: 8px;
  }
</style>
{% endblock %}

{% block content %}
<h5 class="text-center mb-3">{{ shopping_list.name }}</h5>

<form id="add-form" class="d-flex mb-3">
  <input id="item-input" class="form-control me-2" placeholder="Add item..." required>
  <button class="btn btn-success">+</button>
</form>

<div id="items">
  {% for item in shopping_list.items %}
  <div class="list-item">
    <span>{{ item.name }}</span>
    <button class="btn btn-sm btn-outline-danger remove-btn" data-id="{{ item.id }}">✕</button>
  </div>
  {% endfor %}
</div>

<div class="mt-4 text-center">
  <small class="text-muted">Share token: <b>{{ shopping_list.share_token }}</b></small>
</div>
{% endblock %}

{% block scripts %}
<script>
  const socket = io();
  const listId = "{{ shopping_list.id }}";

  const form = document.getElementById('add-form');
  const input = document.getElementById('item-input');
  const itemsDiv = document.getElementById('items');

  form.addEventListener('submit', e => {
    e.preventDefault();
    socket.emit('add_item', { list_id: listId, name: input.value });
    input.value = '';
  });

  itemsDiv.addEventListener('click', e => {
    if (e.target.classList.contains('remove-btn')) {
      const id = e.target.getAttribute('data-id');
      socket.emit('remove_item', { list_id: listId, item_id: id });
    }
  });

  socket.on('item_added', item => {
    const div = document.createElement('div');
    div.classList.add('list-item');
    div.innerHTML = `<span>${item.name}</span>
      <button class="btn btn-sm btn-outline-danger remove-btn" data-id="${item.id}">✕</button>`;
    itemsDiv.appendChild(div);
  });

  socket.on('item_removed', item_id => {
    const btn = document.querySelector(`.remove-btn[data-id="${item_id}"]`);
    if (btn) btn.parentElement.remove();
  });
</script>
{% endblock %}
